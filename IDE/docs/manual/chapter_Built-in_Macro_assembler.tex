In this chapter, we will be concerned with build-in macro assembler. With syntax of its statements, directives, and PicoBlaze assembler instructions. It is assumed, that the reader is familiar with general concepts of assembly language programming and PicoBlaze architecture.

MDS has the most advanced assembler for PicoBlaze currently available on the market. MDS macro-assembler is enhanced with features designed to save your time and make programming a little bit easier. For instance you may use "\verb'if ( S0 == S1 )'" to easy write conditions instead of compares and conditional jumps, "\verb'for ( S0, 0 .. 9 )'" for loops, "\verb'#if my_constant > 20'" for conditional compilation, "\verb'abc macro x, y, z'" for defining your own macros, and plenty more... It supports features for smooth and transparent debugging and it's regularly subjected to extensive automated testing to ensure its very functionality and to provide high reliability.

\section{Basics}
    \subsection{Differences from the Xilinx assembler}
        \begin{itemize}
            \item Code is case insensitive.
            \item Default radix is decimal.
            \item Immediate addressing requires ``\#'' prefix, and indirect addressing requires ``@'' prefix.
        \end{itemize}

    \subsection{Statements}
        Source code files for this assembler have to be text files formed like:\\
        ~\\
        \verb'[ label: ]  [ instruction  [ operand [ , operand [ , operand ] ] ]  [ ;comment ]'\\
        \verb'[ label: ]  directive      [ argument ]                             [ ;comment ]'\\
        \verb'            symbol         directive argument                       [ ;comment ]'\\
        \verb'            directive      symbol, argument                         [ ;comment ]'\\

        Anything in square brackets is optional. Compilation does not continue beyond line containing the \texttt{END} directive so after that directive the code does not have to be syntactically valid. Empty lines are valid, as well as lines containing only comment or label. Statements are separated by white space (spaces or tabs). Statements are case insensitive and their length is not limited, overall line length is also not limited.

    \subsection{Symbols}
        Symbols are user defined symbolic names for numbers or addresses. Symbol names consist of upper and lower case letters, digits, and underscore character (``\_''), their length is not limited, they are case insensitive and they have to be different from language keywords. Be aware of that there cannot coexists two or more symbols which differs only by letter casing, for instance ``\texttt{abc}'' and ``\texttt{ABC}'' are considered by this assembler to be one symbol.

        \paragraph{Example}
        ~\\
        \verb'    First_symbol      EQU     0b100111 ; Number in binary'\\
        \verb'    Second_symbol     SET     47q      ; Octal'\\
        \verb'    Third_symbol      REG     39d      ; Decimal'\\
        \verb'    Fourth_symbol     DATA    27h      ; Hexadecimal'\\
        \verb'    Fifth_symbol      CODE    27h      ; Hexadecimal'

    \subsection{Numeric constants}
        MDS assembler supports multiple radixes for numeric constants, radix is specified wither using prefix or suffix notation.

        ~\\
        \verb"    ; Hexadecimal."\\
        \verb"    ld          S0, #0xAB       ; prefix notation (`0x...')"\\
        \verb"    ld          S0, #0ABh       ; suffix notation (`...h')"\\
        \verb"    ; Decimal."\\
        \verb"    ld          S0, #123        ; no prefix - default radix - decimal"\\
        \verb"    ld          S0, #123d       ; suffix notation (`d')"\\
        \verb"    ; Octal."\\
        \verb"    ld          S0, #076        ; prefix notation (`0...')"\\
        \verb"    ld          S0, #76q        ; suffix notation (`...q')"\\
        \verb"    ld          S0, #76o        ; suffix notation (`...o')"\\
        \verb"    ; Binary."\\
        \verb"    ld          S0, #0b1100     ; prefix notation (`0b...')"\\
        \verb"    ld          S0, #1100b      ; suffix notation (`...b')"\\
        \verb"    ; ASCII."\\
        \verb"    ld          S0, #'A'        ; character capital A"\\
        \verb"    ld          S0, #'\t'       ; tab character"

    \subsection{Expressions}
        Arithmetical expressions are evaluated at compilation time and replaced with constants corresponding to their resulting value. Expressions comprise of arithmetical operators, constants, and symbols. Examples of such expressions:

        \begin{itemize}
            \item \texttt{2+1}
            \item \texttt{(2 + 4) - ABC}
            \item \texttt{A \& B}
            \item \texttt{X / 0FF00h}
            \item \texttt{X * Y + X \% Y}
        \end{itemize}

        When multiple operators occur in an expression, the expression is evaluated in a specific order depending on priorities of the used operators. All logical operators have priorities lower than arithmetic and relational operators.

        The following table shows priority of expression operators, 1 is the highest priority; if priorities are equal then the expression is evaluated from left to right.

        \begin{table}[h!]
            \centering{}
            \mysmallfont{}

            \begin{tabular}{|l|l|l|l|}
                \hline
                Priority & Operator & Description             & Example         \\\hline
                1        & +        & unary plus sign         & +12             \\\hline
                1        & -        & unary minus sign        & -5              \\\hline
                2        & \~{}     & bitwise NOT             & \~{}0a55ah      \\\hline
                2        & !        & logical NOT             & !0a55ah         \\\hline
                3        & *        & unsigned multiplication & 11 * 12         \\\hline
                3        & /        & unsigned divisiono      & 11 / 12         \\\hline
                3        & \%       & unsigned remainder      & 13 \% 11        \\\hline
                4        & +        & unsigned addition       & 3 + 5           \\\hline
                4        & -        & unsigned substraction   & 20 - 4          \\\hline
                5        & <{}<     & binary shift left       & 21 <{}< 4       \\\hline
                5        & >{}>     & binary shift right      & 32 >{}> 2       \\\hline
                6        & <        & less than               & 11 < 12         \\\hline
                6        & <=       & less or equal than      & 11 <= 11        \\\hline
                6        &  >       & greater than            & 12 > 11         \\\hline
                6        & >=       & greater or equal than   & 12 >= 11        \\\hline
                7        & ==       & equal to                & 11 == 11        \\\hline
                7        & !=       & not equal to            &  A != B         \\\hline
                8        & \&       & bitwise and             & 48 \& 16        \\\hline
                8        & |        & bitwise or              & 370q | 7        \\\hline
                9        & \&\&     & logical and             & 48 \&\& 16      \\\hline
                9        & ||       & logical or              & 370q || 7       \\\hline
                9        & \^{}     & exclusive or            & 00fh \^{} 005h  \\\hline
            \end{tabular}

            \caption{Expression operators priority}
        \end{table}

        Priority 1 is the highest priority, and priority 9 is the lowest priority. When operators with different priority levels appear in an expression, operations are evaluated according to priorities. When operators of the same priority appear in an expression, operations are evaluated from left to right.

    \clearpage
    \subsection{Predefined Symbols}
        These symbols are defined by default when you specify the target device (directive ``device''). Symbols S10..S1F are defined for KCPSM2 only, and S8..S1F are not defined for KCPSM1-CPLD.

        \begin{table}[h!]
            \begin{tabular}{|cc|cc|}
                \hline
                Symbol & Value & Symbol & Value \\\hline
                S0     & 0x00  & S10    & 0x10  \\\hline
                S1     & 0x01  & S11    & 0x11  \\\hline
                S2     & 0x02  & S12    & 0x12  \\\hline
                S3     & 0x03  & S13    & 0x13  \\\hline
                S4     & 0x04  & S14    & 0x14  \\\hline
                S5     & 0x05  & S15    & 0x15  \\\hline
                S6     & 0x06  & S16    & 0x16  \\\hline
                S7     & 0x07  & S17    & 0x17  \\\hline
                S8     & 0x08  & S18    & 0x18  \\\hline
                S9     & 0x09  & S19    & 0x19  \\\hline
                SA     & 0x0A  & S1A    & 0x1A  \\\hline
                SB     & 0x0B  & S1B    & 0x1B  \\\hline
                SC     & 0x0C  & S1C    & 0x1C  \\\hline
                SD     & 0x0D  & S1D    & 0x1D  \\\hline
                SE     & 0x0E  & S1E    & 0x1E  \\\hline
                SF     & 0x0F  & S1F    & 0x1F  \\\hline
            \end{tabular}
        \end{table}

\clearpage
\section{Instructions}
    \input{chapter_Built-in_Macro_assembler_instructions.tex}

\clearpage
\section{Pseudo Instructions}
    \input{chapter_Built-in_Macro_assembler_pseudo-instructions.tex}

\clearpage
\section{Assembler directives}
    \input{chapter_Built-in_Macro_assembler_directives.tex}

\section{Error and warning messages}
    This chapter lists the error messages generated by MDS. The following sections include a brief description of the possible error messages along with a description of the error and any corrective actions you can take to avoid or eliminate the error. Errors terminate the assembly and generate a message that is displayed on the console. Warnings generate a message in the assembly listing file but do not terminate the assembly.

    \subsection{Errors}
        \begin{description}
            \item[Unable to open file]
                The given file cannot be opened for some reason.
            \item[Unable to write to file]
                It is not possible to write into given file.
            \item[Unable to save file]
                The given file cannot be saved. Check if you have enough space on your disk.
            \item[The resulting machine code is too big to be stored in a file]
                Size of the resulting machine code is bigger, than free disk space.
            \item[Some of the source code files were aparently changed during compilation]
                Do not change source files during the compilation. Wait for compilation to be finished.
            \item[User defined memory limit for program memory exceeded]
                You have exceeded maximum program memory defined with directive LIMIT or project configuration.
            \item[User defined memory limit for register file exceeded]
                You have exceeded maximum number of working registers defined with directive LIMITor project configuration.
            \item[User defined memory limit for Scratch Pad RAM exceeded]
                You have exceeded maximum scratch pad RAM defined with directive LIMIT or project configuration.
            \item[Instruction X requires operand \#Y to be of type(s) Z]
                Wrong type of operand.
            \item[Macro not defined ]
                The given macro has not been defined. You must define macro before you can use it. See chapter MACROS for more info.
            \item[Too many arguments given, expecting at most X arguments]
                Too many arguments. Reduce number of given arguments.
            \item[Attempting to use unavailable space in X memory at address: Y ]
                Desired memory space is not available.
            \item[The last error was critical, compilation aborted]
                Critical error has occured. Compilation cannot continue.
            \item[Device not supported]
                The given device is not supported. Please choose different device in project configuration.
            \item[Device specification code is already loaded ]
                You have already specified architecture in project configuration.
            \item[Limit value X is not valid]
                Invalid limit value. Viz. LIMIT directive chapter for valid values.
            \item[Directive `LOCAL' cannot appear outside of macro definition ]
                Directive LOCAL must be only used inside of macro. Use different directive for symbol definition( EQU,SET etc.), or put it inside of macro.
            \item[Directive EXITM' cannot apper outside macro definition]
                The given directive is used to immediately exit macro. It does not make sense to use it differently.
            \item[Maximum macro expansion level X reached  ]
                Maximum macro expansion level reached. You can change your compiler settings and set bigger expansion level. By default, macro expansion level is unlimited.
            \item[Maximum number of WHILE directive iterations reached ]
                Maximum WHILE directive iterations reached. You can change your compiler settings and allow more iterations. By default, number of iterations is unlimited.
            \item[Maximum number of REPEAT directive iterations reached ]
                Maximum REPEAT directive iterations reached. You can change your compiler settings and allow more iterations. By default, number of iterations is unlimited.
            \item[Instruction word is only 18 bits wide, value X trimmed to Y ]
                You have exceeded instruction word length. Value has been trimmed to  appropriate length.
            \item[Symbol already defined]
                The given symbol has been already defined. Symbol cannot be defined more than one time.
            \item[Symbol not defined: X ]
                The given symbol has not been defined. Symbol has to be defined before usage.
            \item[Symbol X already defined with type Y]
                The given symbol has been already defined with type Y. Symbol cannot be defined more than one time.
            \item[Undefined value ]
                Undefined value. You need to specify the value.
            \item[Real numbers are not supported in assembler ]
                Real numbers cannot be used on 8-bit processor.
            \item[Undefined symbol: X ]
                Symbol has not been defined. Define symbol before usage.
            \item[This value is not valid inside of expression ]
                The given expression contains forbidden value.
            \item[Division by zero ]
                Division by zero has been detected. It is not possible to divide with zero, therefore compilation is aborted.
            \item[Unable to resolve this expression ]
                The given expression cannot be resolved. Check if expression is syntactically right.
            \item[Syntax not understood ]
                There is syntax error in your source code.
            \item[Character constant is too long ]
                Character constant is too long. Check ASCII table for appropriate values.
            \item[Unterminated string or character constant ]
                Unterminated string or character constant. You probably forgot to end with ''.
            \item[Unrecognized escape sequence: ]
                Unrecognized escape sequence. Check ASCII table for appropriate values.
            \item[No file name specified ]
                File name has to be specified.
            \item[Unable to open the specified file: X]
                The given file cannot be opened for some reason.
            \item[Unrecognized token:  ]
                Source code contains invalid characters.
        \end{description}

    \subsection{Warnings}
        \begin{description}
            \item[Maximum number of messages reached, suppressing compiler message generation]
                Source code contains a big number of errors. Those errors were suppressed to prevent enormous size of code listing file.
            \item[Redefinition of macro ]
                The given macro has already been defined.
            \item[Macro X will not be expanded because macro expansion has been disabled]
                The given macro cannot be expanded because macro expansion has been disabled by NOEXPAND directive. You can use EXPAND directive to allow expansion again.
            \item[Parameter X substituted for blank value ]
                Macro expected input parameter. Compiler replaced it with blank parameter.
            \item[Symbol X already declared as local ]
                Symbol is already used as local inside of macro.
            \item[Reusing already reserved space in X memory at address: Y]
                Memory space is already defined. Make sure the collision will not occur.
            \item[Limit value -1 means unlimited]
                You can define limit values with LIMIT directive. Using -1 as directive argument, means unlimited.
            \item[Symbol X declared as local but never used, declaration ignored]
                The given local symbol has been declared but never used. Declaration will be ignored.
            \item[Comparing two immediate constants, result is always positive]
                Comparing two immediate constants, result will be always same.
            \item[Comparing two immediate constants, result is always negative]
                Comparing two immediate constants, result will be always same.
            \item[Sign overflow. Result is negative number lower than the lowest negative...]
                Two's complement sign overflow.
            \item[Result is negative number X, this will be represented as X-bit number...]
                Result is negative number. This will be represented as number in two's complement arithmetic.
            \item[Value out of range, allowed range is [0,2] (trimmed to 3 bits) which makes it 4 ]
                Value out of range. Adjust input value.
            \item[Maximum number of messages reached, suppressing compiler message generation ]
                Compiler is suppressing error messages generation to avoid massive code listing file size.
            \item[File name contains a null character ]
                Null character in file name is forbidden. Please change the name of the given file.
        \end{description}

\section{Symbol table}
    Symbol table contains list of symbols defined in your source code with additional information.

    \paragraph{File format}
        ~\\
        The table of symbols is text file consisting of a number of lines with following format:\\
        \begin{tabular}{|cccccc|}
            \hline
            Name & Type & Value & Usage & Parameter & Location \\
            \hline
        \end{tabular}

    \begin{description}
        \item[Name]
            Symbol name.

        \item[Type]
            Defines symbol type.
            \begin{itemize}
                \item PORT: Symbol should be used as PORT\_ID indicator.
                \item DATA: Symbol should be used only as a scatch\-pad ram data.
                \item LABEL: Symbol is label defining address in program memory.
                \item REGISTER: Symbol represents one of the internal registers.
                \item EXPRESION: Symbol is defined as an expression.
                \item NUMBER: Symbol does not have specific type.
            \end{itemize}

        \item[Value]
            Value assigned to the symbol.

        \item[Usage]
            USED or NOT USED.

        \item[Parameter]
            \begin{itemize}
                \item IMPLICIT: Symbol is defined implicitly for your architecture.
                \item LOCAL: Local symbol in some macro.
                \item REDEFINABLE: Symbol is re-definable, i.e. is not constant.
                \item CONSTANT: Symbol cannot be redefined, i.e. is constant.
            \end{itemize}

        \item[Location]
            Location of symbol definition formatted as: <file-name>:<line-number>.<column>.<line-number>.<column>
    \end{description}

\section{Macro table}
    Macro table contains list of macros in your source code with additional information.\\

    \paragraph{File format}
        ~\\
        The table of symbols is text file consisting of a number of lines with following format:\\
        \begin{tabular}{|cccccc|}
            \hline
            Name & & Usage & Type & Location \\
            \hline
        \end{tabular}

    \begin{description}
        \item[Name]
            Name of macro.
        \item[Usage]
            It tells you how many times the macro was used.
        \item[Location]
            Location of macro definition formatted as: <file-name>:<line-number>.<column>.<line-number>.<column>
    \end{description}

\clearpage
\section{MEM File}
    MEM file contains machine code generated by the assembler. There are 17 columns 4 byte wide, the first column starts with ``\@'' and represents address, other columns contain instruction opcodes. Unused locations are filled with zeros, i.e. if there is no instruction on a certain address, it is filled with zeros.

    \paragraph{Example}
        ~\\
        \verb'@0000 000011F7 00001299 0000132E ... ... ... 00004577 00007789 000015A4'\\
        \verb'...'\\
        \verb'...'\\
        \verb'...'\\
        \verb'@0040 000004DF 000047F4 00000000 ... ... ... 00000000 00000000 00000000'\\
        \verb'@0080 00000000 00000000 00000000 ... ... ... 00000000 00000000 00000000'\\
        \verb'@00C0 00000000 00000000 00000000 ... ... ... 00000000 00000000 00000000'\\
        \verb'@0100 00000000 00000000 00000000 ... ... ... 00000000 00000000 00000000'\\
        \verb'...'\\
        \verb'...'\\
        \verb'...'\\
        \verb'@3F80 000011F7 00001299 0000132E ... ... ... 00000000 00000000 00000000'\\
        \verb'@3FC0 000011F7 00001299 0000132E ... ... ... 00000000 00000000 00000000'\\

\clearpage
\section{Raw Hex Dump file}
    Raw Hex Dump is very simple: file starts with hexadecimal representation of opcode of the first instruction in your program at address 0 then it is followed by opcode at address 0x1, 0x2, and so on. Unused locations are filled with zeros.

    \paragraph{Example}
        ~\\
        \verb'011F7'\\
        \verb'01299'\\
        \verb'0132E'\\
        \verb'19101'\\
        \verb'00000'\\
        \verb'19201'\\
        \verb'00000'\\
        \verb'19301'\\
        \verb'00000'\\
        \verb'00000'\\
        \verb'00...'\\
        \verb'.....'\\
        \verb'...00'\\

\section{Raw binary file}
    Bin file gives you raw data from program memory. It contains OP Codes of instructions in 3 bytes (18 bit instructions) or 2 bytes (16 bit instructions) sorted in a line. It does not contain unused memory.

    Example:\\
    {
        \usecodefont
        \verb'; Starting at address 0x0'\\
        \verb'; Displayed OPcodes 22045, 3EF45, 08FF0 (18bit instr.) would be:'\\
        \verb'  02204503EF45008FF0 '\\\\
        \verb'; Displayed OPcodes 2045, 3EF4, 08F0 (16bit instr.) would be:'\\
        \verb'  20453EF408F0 '\\
    }

\clearpage
\section{Motorola S-Rec format}
    Motorola S-records are a form of simple ASCII encoding for binary data. This format is commonly used for firmware uploads to GPSes, industrial robots, and other kinds of microcontroller-driven hardware. It has several convenient properties, including inspectability, easy editing with any text editor, and checksumming for verification of transmission across noisy serial lines. An S-record file consists of a sequence of specially formatted ASCII character strings. An S-record will be less than or equal to 78 bytes in length. The order of S-records within a file is of no significance and no particular order may be assumed.

    The general format of an S-record follows:\\
    {
        \usecodefont
        \verb'  +-------------------//------------------//-----------------------+'\\
        \verb'  | type | count | address  |            data           | checksum |'\\
        \verb'  +-------------------//------------------//-----------------------+'\\
    }

    \begin{description}
        \item[Type]
            A char[2] field. These characters describe the type of record (S0,S1, S2, S3, S5, S7, S8, or S9).

        \item[Count]
            A char[2] field. These characters when paired and interpreted as a hexadecimal value, display the count of remaining character pairs in the record.

        \item[Address]
            A char[4,6, or 8] field. These characters grouped and interpreted as a hexadecimal value, display the address at which the data field is to be loaded into memory. The length of the field depends on the number of bytes necessary to hold the address. A 2-byte address uses 4 characters, a 3-byte address uses 6 characters, and a 4-byte address uses 8 characters.

        \item[Data]
            A char [0-64] field. These characters when paired and interpreted as hexadecimal values represent the memory loadable data or descriptive information.

        \item[Checksum]
            A char[2] field. These characters when paired and interpreted as a hexadecimal value display the least significant byte of the ones complement of the sum of the byte values represented by the pairs of characters making up the count, the address, and the data fields.
    \end{description}

    Each record is terminated with a line feed. If any additional or different record terminator(s) or delay characters are needed during transmission to the target system it is the responsibility of the transmitting program to provide them.

    \subsection{Record types}
        \begin{description}
            \item[S0]
                The type of record is S0 (0x5330). The address field is unused and will be filled with zeros (0x0000). The header information within the data field is divided into the following subfields.

                \begin{itemize}
                    \item mname is char[20] and is the module name.
                    \item ver is char[2] and is the version number.
                    \item rev is char[2] and is the revision number.
                    \item description is char[0-36] and is a text comment.
                \end{itemize}

                Each of the subfields is composed of ASCII bytes whose associated characters when paired, represent one byte hexadecimal values in the case of the version and revision numbers, or represent the hexadecimal values of the ASCII characters comprising the module name and description.

            \item[S1]
                The type of record field is S1 (0x5331). The address field is interpreted as a 2-byte address. The data field is composed of memory loadable data.

            \item[S2]
                The type of record field is S2 (0x5332). The address field is interpreted as a 3-byte address. The data field is composed of memory loadable data.

            \item[S3]
                The type of record field is S3 (0x5333). The address field is interpreted as a 4-byte address. The data field is composed of memory loadable data.

            \item[S5]
                The type of record field is S5 (0x5335). The address field is interpreted as a 2-byte value and contains the count of S1, S2, and S3 records previously transmitted. There is no data field.

            \item[S7]
                The type of record field is S7 (0x5337). The address field contains the starting execution address and is interpreted as a 4-byte address. There is no data field.

            \item[S8]
                The type of record field is S8 (0x5338). The address field contains the starting execution address and is interpreted as a 3-byte address. There is no data field.

            \item[S9]
                The type of record field is S9 (0x5339). The address field contains the starting execution address and is interpreted as a 2-byte address. There is no data field.
        \end{description}

    \subsection{Example}
        Shown below is a typical S-record format file.

        {
            \usecodefont
            \verb''\\
            \verb'S00600004844521B'\\
            \verb'S1130000285F245F2212226A000424290008237C2A'\\
            \verb'S11300100002000800082629001853812341001813'\\
            \verb'S113002041E900084E42234300182342000824A952'\\
            \verb'S107003000144ED492'\\
            \verb'S5030004F8'\\
            \verb'S9030000FC'\\
        }

        The file consists of one S0 record, four S1 records, one S5 record and an S9 record.

    \subsubsection{The S0 record is comprised as follows:}
        \begin{itemize}
            \item S0 S-record type S0, indicating it is a header record.
            \item 06 Hexadecimal 06 (decimal 6), indicating that six character pairs (or ASCII bytes) follow.
            \item 00 00 Four character 2-byte address field, zeros in this example.
            \item 48 44 52 ASCII H, D, and R - "HDR".
            \item 1B The checksum.
        \end{itemize}

    \subsubsection{The first S1 record is comprised as follows:}
        \begin{itemize}
            \item S1 S-record type S1, indicating it is a data record to be loaded at a 2-byte address.
            \item 13 Hexadecimal 13 (decimal 19), indicating that nineteen character pairs, representing a 2 byte address, 16 bytes of binary data, and a 1 byte checksum, follow.
            \item 00 00 Four character 2-byte address field; hexadecimal address 0x0000 where the data which follows is to be loaded.
            \item 28 5F 24 5F 22 12 22 6A 00 04 24 29 00 08 23 7C Sixteen character pairs representing the actual binary data.
            \item 2A The checksum.
        \end{itemize}

    \subsubsection{The second and third S1 records are comprised as follows:}
        The second and third S1 records each contain 0x13 (19) character pairs and are ended with checksums of 13 and 52, respectively. The fourth S1 record contains 07 character pairs and has a checksum of 92.

    \subsubsection{The S5 record is comprised as follows:}
        \begin{itemize}
            \item S5 S-record type S5, indicating it is a count record indicating the number of S1 records
            \item 03 Hexadecimal 03 (decimal 3), indicating that three character pairs follow.
            \item 00 04 Hexadecimal 0004 (decimal 4), indicating that there are four data records previous to this record.
            \item F8 The checksum.
        \end{itemize}

    \subsubsection{The S9 record is comprised as follows:}
        \begin{itemize}
            \item S9 S-record type S9, indicating it is a termination record.
            \item 03 Hexadecimal 03 (decimal 3), indicating that three character pairs follow.
            \item 00 00 The address field, hexadecimal 0 (decimal 0) indicating the starting execution address.
            \item FC The checksum.
        \end{itemize}

\section{Generated VHDL and Verilog files}
    As you know, the PicoBlaze microcontroller is primarily designed for use in a VHDL design flow. MDS will generate all necessary files, that are needed for implementation in FPGA. The compiler will read the template and insert the information required to complete the definition of program ROM and write it out to new '.vhd' or '.v' file that is ready for synthesis and simulation.

    Template can be modified to define alternative memory definitions. However, you are responsible for ensuring the template is correct as the compiler does not perform any checking of the VHDL.

    The compiler identifies all text enclosed by {} characters, and replaces these character strings. All templates should include these {} character strings for the compiler to work correctly. Basically the MDS replaces instances on {INIT\_XX}, {INITP\_XX} and {INIT64\_X}, {INIT128\_X}, {INIT256\_X} by constant strings with the appropriate values, similar to the kcpsmX tools of Xilinx.

\section{List File Format}
    Code listing serves as an additional information about the assembled code and the progress of the assembly process. It contains information about all symbols defined in the code. Where and how were they were defined, what are their values and whether they were used in the code. Also detailed information about all macros defined in the code and/or expanded in the code. Conditional compilation configuration, instruction OP codes, address space reservations, inclusion of code from another files. And all warnings, errors and notes generated during the assembly by the assembler.

    There are assembler control sequences which alters formatting of the code listing file. These control sequences will be discussed here. Format of code listing generated by this assembler is very similar to the one generated Metalink(R) ASM51.

    \begin{code}[h]
        \mysmallfont{}
        \verb'demo0                                         PAGE 1'\\
        \verb'                         1     ; Demostration code'\\
        \verb'                         2             org     0'\\
        \verb'                         3'\\
        \verb'0000 01001               4     main:   load    s0, #1'\\
        \verb'0001 01102               5             load    s1, #2'\\
        \verb'0005 01203               6             load    s2, #3'\\
        \verb'0007 3E000               7             jump    main'\\
        \verb'                         8'\\
        \verb'                         9             end'\\
        \caption{A simple code listing}
    \end{code}

    Code listing contains entire source code which was assembled but with each line prefixed with line number and some additional information which will be explained later. Besides the original code there is also table of symbols defined during the assembly unless it was turned off. Code listing is divided into pages separated by form feed character, this behavior may be altered by certain assembler control sequences as well as page height and width.

    Each line of code listing which contains original source code line may contain beside line number also some additional information regarding the compilation of the given line of code. Such a additional information might look like this and is composed of these parts:

    \begin{code}[h]
        {
            \usecodefont
            \verb'  '{\color{Lavender}{0055}}\verb'                  '{\color{Goldenrod}{18}}\verb'      '{\color{Gray}{X      data     55h}}\\
            {\color{Apricot}{0014}}\verb' '{\color{GreenYellow}{1122}}\verb'       '{\color{LimeGreen}{=1}}\verb'      '{\color{Goldenrod}{33}}\verb'      '{\color{Gray}{l:     inc      s0}}\\
            \verb'                        '{\color{Goldenrod}{35}}\verb' '{\color{ProcessBlue}{+1}}\verb'   '{\color{Gray}{abc     ; Expand macro ``abc'' here}}\\
            {\color{Apricot}{001E}}\verb' '{\color{GreenYellow}{E580}}\verb'               '{\color{Goldenrod}{36}}\verb' '{\color{ProcessBlue}{+1}}\verb'  '{\color{Gray}{                LOAD     s1, s0}}\\
            {\color{Apricot}{0020}}\verb' '{\color{GreenYellow}{F410}}\verb'               '{\color{Goldenrod}{37}}\verb' '{\color{ProcessBlue}{+1}}\verb'  '{\color{Gray}{                SR0     s1}}\\
            {\color{Apricot}{0021}}\verb' '{\color{GreenYellow}{F590}}\verb'               '{\color{Goldenrod}{38}}\verb' '{\color{ProcessBlue}{+1}}\verb'  '{\color{Gray}{                LOAD     s2, s1}}\\

            \colorbox{Goldenrod}{\color{Goldenrod}X} Line number\\
            \colorbox{LimeGreen}{\color{LimeGreen}X} Level of file inclusion\\
            \colorbox{ProcessBlue}{\color{ProcessBlue}X} Level of macro expansion\\
            \colorbox{Apricot}{\color{Apricot}X} Address in code memory\\
            \colorbox{GreenYellow}{\color{GreenYellow}X} Machine code or another value to be stored in the code memory\\
            \colorbox{Lavender}{\color{Lavender}X} Value of a symbol\\
            \colorbox{Gray}{\color{Gray}X} Original line\\
        }
        \caption{Format of code listing}
    \end{code}

    \begin{code}[h]
        \mysmallfont{}
        \verb'complicated_lst                                                                                                         '{\color{highlight_macro}\verb'PAGE'}\verb' '{\color{highlight_unknown_base}\verb'1'}\\
        {\color{highlight_lst_number}\verb'  001C'}{\color{highlight_lst_line}\verb'               1'}\verb'     '{\color{highlight_constant}\verb'abc'}\verb'     '{\color{highlight_directive}\verb'equ'}\verb'     '{\color{highlight_symbol}\verb'('}\verb' '{\color{highlight_unknown_base}\verb'14'}\verb' '{\color{highlight_symbol}\verb'*'}\verb' '{\color{highlight_unknown_base}\verb'2'}\verb' '{\color{highlight_symbol}\verb')'}\verb'      '{\color{highlight_comment}\verb'; Define symbol abc'}\\
        {\color{highlight_lst_line}\verb'                     2'}\verb'             '{\color{highlight_directive}\verb'org'}\verb'     '{\color{highlight_unknown_base}\verb'0'}\verb'               '{\color{highlight_comment}\verb'; Code at address 0'}\\
        {\color{highlight_lst_line}\verb'                     3'}\\
        {\color{highlight_lst_include}\verb'             =1'}{\color{highlight_lst_line}\verb'      4'}\verb'             '{\color{highlight_directive}\verb'include'}\verb' '{\color{highlight_string}\verb''\verb"'"\verb'my_macros.asm'\verb"'"\verb' '{\color{highlight_comment}\verb'; Include my_macros.asm'}}\\
        {\color{highlight_lst_include}\verb'             =1'}{\color{highlight_lst_line}\verb'      5'}\verb'     '{\color{highlight_comment}\verb'; This is the beginning of file my_macros.asm'}\\
        {\color{highlight_lst_include}\verb'             =1'}{\color{highlight_lst_line}\verb'      6'}\verb'     '{\color{highlight_macro}\verb'my_cpl'}\verb'  '{\color{highlight_directive}\verb'macro'}\verb'   '{\color{highlight_constant}\verb'foo'}\\
        {\color{highlight_lst_include}\verb'             =1'}{\color{highlight_lst_line}\verb'      7'}\verb'             '{\color{highlight_instruction}\verb'load'}\verb'     '{\color{highlight_sfr}\verb's3'}{\color{highlight_oper_sep}\verb','}\verb' '{\color{highlight_constant}\verb'foo'}\\
        {\color{highlight_lst_include}\verb'             =1'}{\color{highlight_lst_line}\verb'      8'}\verb'             '{\color{highlight_instruction}\verb'add'}\verb'      '{\color{highlight_sfr}\verb's3'}\\
        {\color{highlight_lst_include}\verb'             =1'}{\color{highlight_lst_line}\verb'      9'}\verb'             '{\color{highlight_instruction}\verb'load'}\verb'     '{\color{highlight_constant}\verb'foo'}{\color{highlight_oper_sep}\verb','}\verb' '{\color{highlight_sfr}\verb's3'}\\
        {\color{highlight_lst_include}\verb'             =1'}{\color{highlight_lst_line}\verb'     10'}\verb'     '{\color{highlight_directive}\verb'endm'}\\
        {\color{highlight_lst_include}\verb'             =1'}{\color{highlight_lst_line}\verb'     11'}\verb'     '{\color{highlight_comment}\verb'; This is the end of file my_macros.asm'}\\
        {\color{highlight_lst_line}\verb'                    12'}\\
        {\color{highlight_lst_line}\verb'                    13'}{\color{highlight_lst_macro}\verb' +1'}\verb'  '{\color{highlight_label}\verb'main:'}\verb'   '{\color{highlight_macro}\verb'my_cpl'}\verb'  '{\color{highlight_sfr}\verb's0'}\verb'          '{\color{highlight_comment}\verb'; Expand macro my_cpl here'}\\
        {\color{highlight_lst_address}\verb'0000'}{\color{highlight_lst_code}\verb' E580'}{\color{highlight_lst_line}\verb'           14'}{\color{highlight_lst_macro}\verb' +1'}\verb'                  '{\color{highlight_instruction}\verb'load'}\verb'     '{\color{highlight_sfr}\verb's1'}{\color{highlight_oper_sep}\verb','}\verb' '{\color{highlight_sfr}\verb's0'}\\
        {\color{highlight_lst_address}\verb'0002'}{\color{highlight_lst_code}\verb' F4'}{\color{highlight_lst_line}\verb'             15'}{\color{highlight_lst_macro}\verb' +1'}\verb'                  '{\color{highlight_instruction}\verb'add'}\verb'      '{\color{highlight_sfr}\verb's1'}\\
        {\color{highlight_lst_address}\verb'0003'}{\color{highlight_lst_code}\verb' F580'}{\color{highlight_lst_line}\verb'           16'}{\color{highlight_lst_macro}\verb' +1'}\verb'                  '{\color{highlight_instruction}\verb'load'}\verb'     '{\color{highlight_sfr}\verb's0'}{\color{highlight_oper_sep}\verb','}\verb' '{\color{highlight_sfr}\verb's1'}\\
        {\color{highlight_lst_address}\verb'0005'}{\color{highlight_lst_code}\verb' 80F9'}{\color{highlight_lst_line}\verb'           17'}\verb'             '{\color{highlight_instruction}\verb'jmp'}\verb'    '{\color{highlight_constant}\verb'main'}\verb'        '{\color{highlight_comment}\verb'; Jump back to label main'}\\
        {\color{highlight_lst_line}\verb'                    18'}\verb'             '{\color{highlight_directive}\verb'end'}\verb'                 '{\color{highlight_comment}\verb'; End of assembly'}\\
        {\color{highlight_lst_msg}\verb'ASSEMBLY COMPLETE,'}\verb' NO ERRORS FOUND, NO WARNINGS'\\
        \caption{A more complicated example of code listing}
    \end{code}

    \clearpage

\section{Specification of Intel(R) 8 HEX Format}
    Intel(R) 8 HEX is a popular object file format capable of containing up to 64kB of data. Hex files have usually extension .hex or .ihx. These files are text files consisting of a sequence of records, each line line can contain at most one record. Records starts with ``:'' (colon) character at the beginning of the line and ends by end of the line. Everything else besides records should be ignored. Records consist of a sequence of 8-bit hexadecimal numbers (e.g. ``a2'' or ``8c''). These numbers are divided into ``fields'' with different meaning, see the example below.

    \begin{code}[h]
        \caption{An example of an Intel(R) 8 hex code}
        \mysmallfont{}
        \texttt{\colorbox{Goldenrod}{:}\colorbox{green}{0F}\colorbox{blue}{0000}\colorbox{Apricot}{00}\colorbox{GreenYellow}{E580F4F590E580F4F590E580F4F590}\colorbox{Lavender}{57}}\\
        \texttt{\colorbox{Goldenrod}{:}\colorbox{green}{0F}\colorbox{blue}{000F}\colorbox{Apricot}{00}\colorbox{GreenYellow}{E580F4F590E580F4F590E580F4F590}\colorbox{Lavender}{48}}\\
        \texttt{\colorbox{Goldenrod}{:}\colorbox{green}{0F}\colorbox{blue}{001E}\colorbox{Apricot}{00}\colorbox{GreenYellow}{E580F4F590E580F4F590E580F4F590}\colorbox{Lavender}{39}}\\
        \texttt{\colorbox{Goldenrod}{:}\colorbox{green}{10}\colorbox{blue}{002D}\colorbox{Apricot}{00}\colorbox{GreenYellow}{E580F4F5907410B3758010B2907410B3}\colorbox{Lavender}{30}}\\
        \texttt{\colorbox{Goldenrod}{:}\colorbox{green}{10}\colorbox{blue}{003D}\colorbox{Apricot}{00}\colorbox{GreenYellow}{758010B2902694052600940426940526}\colorbox{Lavender}{0A}}\\
        \texttt{\colorbox{Goldenrod}{:}\colorbox{green}{10}\colorbox{blue}{004D}\colorbox{Apricot}{00}\colorbox{GreenYellow}{00940426009404269405E580F4F59026}\colorbox{Lavender}{8A}}\\
        \texttt{\colorbox{Goldenrod}{:}\colorbox{green}{0B}\colorbox{blue}{005D}\colorbox{Apricot}{00}\colorbox{GreenYellow}{009404269405E580F4F590}\colorbox{Lavender}{63}}\\
        \texttt{\colorbox{Goldenrod}{:}\colorbox{green}{00}\colorbox{blue}{0000}\colorbox{Apricot}{01}\colorbox{Lavender}{FF}}\\\\
        \colorbox{Goldenrod}{\color{Goldenrod}X} Start code\\
        \colorbox{green}{\color{green}X} Byte count\\
        \colorbox{blue}{\color{blue}X} Address\\
        \colorbox{Apricot}{\color{Apricot}X} Record type\\
        \colorbox{GreenYellow}{\color{GreenYellow}X} Data\\
        \colorbox{Lavender}{\color{Lavender}X} Checksum (two's complement of 8-bit sum of entire record, except for the start code and the checksum itself)
    \end{code}
