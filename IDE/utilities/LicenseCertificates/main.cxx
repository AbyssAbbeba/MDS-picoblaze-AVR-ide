
#include "LicenseCertificates.h"

#include "rsa.h"
using CryptoPP::RSA;
using CryptoPP::RSASS;
using CryptoPP::InvertibleRSAFunction;
#include "base64.h"
#include "pssr.h"
using CryptoPP::PSS;

#include "sha.h"
using CryptoPP::SHA1;

#include "files.h"
using CryptoPP::FileSink;
using CryptoPP::FileSource;

#include "filters.h"
using CryptoPP::SignerFilter;
using CryptoPP::SignatureVerificationFilter;
using CryptoPP::StringSink;
using CryptoPP::StringSource;

#include "osrng.h"
using CryptoPP::AutoSeededRandomPool;

#include "secblock.h"
using CryptoPP::SecByteBlock;

#include <string>
using std::string;

#include <iostream>
using std::cout;
using std::endl;

int main ( int argc, char ** argv )
{

// gawk '{print($2)}' /home/millenium/.ssh/id_rsa.pub | base64 -d | hexdump -vb | gawk 'BEGIN {c=0} END {print("\n" c)} {for(i=2;i<=NF;i++) {printf("\\%s", $i);c++}}'
// std::string pub_key = std::string("\000\000\000\007\163\163\150\055\162\163\141\000\000\000\003\001\000\001\000\000\001\001\000\334\156\374\371\130\000\064\051\111\235\160\032\035\177\243\075\303\111\132\316\267\240\347\305\210\327\265\072\260\356\361\302\054\257\210\110\162\041\227\121\261\102\213\203\353\330\172\104\321\257\371\340\101\053\362\166\326\114\344\074\170\314\060\077\020\330\240\132\270\155\350\305\267\352\043\202\071\346\353\115\143\341\067\233\007\003\120\303\253\272\244\104\252\153\174\315\112\064\332\014\167\251\150\136\302\342\123\123\130\161\147\244\305\130\325\124\252\265\231\170\022\143\361\067\376\056\035\207\273\357\315\312\220\330\264\312\320\020\047\042\350\215\014\270\050\150\063\146\300\140\101\036\114\054\066\213\227\127\343\323\220\141\260\062\343\176\173\331\206\175\260\125\113\103\061\255\067\006\247\040\304\201\302\162\130\165\305\005\156\241\124\333\000\053\213\057\231\071\260\244\110\155\014\243\347\146\350\130\005\366\111\116\006\174\300\170\311\246\213\244\326\324\006\151\157\302\134\276\147\117\153\034\243\235\115\247\006\156\227\131\204\327\230\277\054\316\172\340\142\360\302\103\364\103\231\077", 279 );
// cat /home/millenium/.ssh/id_rsa | gawk '/^-----/ {next} {printf($0)}' | base64 -d | hexdump -vb | gawk 'BEGIN {c=0} END {print("\n" c)} {for(i=2;i<=NF;i++) {printf("\\%s", $i);c++}}'
// std::string priv_key = std::string( "\060\202\004\244\002\001\000\002\202\001\001\000\334\156\374\371\130\000\064\051\111\235\160\032\035\177\243\075\303\111\132\316\267\240\347\305\210\327\265\072\260\356\361\302\054\257\210\110\162\041\227\121\261\102\213\203\353\330\172\104\321\257\371\340\101\053\362\166\326\114\344\074\170\314\060\077\020\330\240\132\270\155\350\305\267\352\043\202\071\346\353\115\143\341\067\233\007\003\120\303\253\272\244\104\252\153\174\315\112\064\332\014\167\251\150\136\302\342\123\123\130\161\147\244\305\130\325\124\252\265\231\170\022\143\361\067\376\056\035\207\273\357\315\312\220\330\264\312\320\020\047\042\350\215\014\270\050\150\063\146\300\140\101\036\114\054\066\213\227\127\343\323\220\141\260\062\343\176\173\331\206\175\260\125\113\103\061\255\067\006\247\040\304\201\302\162\130\165\305\005\156\241\124\333\000\053\213\057\231\071\260\244\110\155\014\243\347\146\350\130\005\366\111\116\006\174\300\170\311\246\213\244\326\324\006\151\157\302\134\276\147\117\153\034\243\235\115\247\006\156\227\131\204\327\230\277\054\316\172\340\142\360\302\103\364\103\231\077\002\003\001\000\001\002\202\001\000\150\352\346\273\143\070\115\233\155\057\143\100\372\323\132\206\066\041\376\367\257\015\005\343\316\073\045\106\067\032\263\265\001\001\327\062\354\047\262\327\056\060\207\051\026\043\046\047\005\112\345\372\347\352\033\360\226\025\150\370\243\142\104\200\157\353\073\177\222\222\265\235\015\351\202\127\044\152\025\212\363\104\051\354\076\315\104\056\255\331\033\000\227\300\253\131\046\275\273\036\376\001\202\354\277\203\153\267\232\273\367\141\304\220\200\221\130\343\060\225\246\343\054\327\302\302\176\110\316\360\170\351\062\265\053\247\330\323\366\246\153\100\374\323\320\024\000\177\205\210\134\144\370\313\003\004\040\252\207\323\133\052\047\122\344\253\017\113\254\055\051\366\021\223\035\164\331\000\325\131\312\076\223\322\212\047\326\321\000\104\012\047\164\154\174\010\015\020\314\000\007\222\000\110\145\267\116\241\357\124\077\345\347\070\076\367\154\231\132\046\361\000\373\375\331\217\170\251\223\102\345\316\164\116\160\237\020\214\272\274\216\111\252\103\035\264\304\230\134\260\121\153\253\111\124\061\002\201\201\000\376\127\154\130\342\247\004\122\143\061\237\231\206\075\026\003\011\367\274\325\132\031\025\147\252\264\167\014\326\217\173\334\040\005\166\332\011\227\112\137\236\150\343\326\245\157\337\005\054\334\265\156\274\032\253\203\111\360\351\325\113\271\165\073\323\127\152\316\035\033\012\047\211\347\027\110\153\053\110\140\274\353\025\201\150\053\073\311\160\174\330\153\172\172\272\322\300\165\175\171\216\030\257\074\144\174\327\226\046\161\036\071\104\163\135\120\005\102\273\004\211\066\155\321\066\217\232\111\002\201\201\000\335\336\366\071\003\263\021\271\015\032\213\007\231\214\325\211\134\060\250\116\135\137\331\206\255\005\367\331\353\056\317\003\242\161\165\252\374\221\331\152\350\227\147\104\236\275\311\233\310\155\273\024\306\061\255\226\223\332\300\045\272\257\143\304\057\015\236\353\157\133\360\177\310\312\071\247\011\345\125\174\130\141\215\340\263\055\350\037\220\325\045\116\206\165\231\344\205\371\275\356\215\206\166\313\205\347\222\061\375\032\030\301\345\123\077\127\256\314\066\164\346\142\270\066\124\371\127\107\002\201\200\075\141\113\274\207\266\126\314\253\063\246\230\236\124\317\243\034\034\265\155\247\270\265\371\266\260\246\252\152\175\146\036\321\173\200\033\116\205\074\145\247\015\031\057\013\355\333\234\234\037\007\212\031\313\065\351\021\107\032\247\147\006\362\313\345\115\013\161\202\204\254\006\256\271\036\135\123\277\266\117\342\107\271\200\351\152\305\232\357\222\261\207\376\236\357\307\074\273\035\364\337\336\005\054\105\363\372\363\071\203\303\017\176\375\170\137\177\145\203\114\254\360\175\300\047\262\260\101\002\201\201\000\252\007\244\112\055\073\235\351\142\321\144\232\176\142\037\203\024\323\165\050\031\006\313\175\032\073\350\245\150\106\206\377\022\016\101\116\270\040\115\256\120\161\067\002\257\144\142\214\260\034\347\262\023\361\036\106\267\050\174\370\155\010\334\074\014\223\063\246\331\300\153\236\202\021\367\374\272\350\265\212\205\160\275\171\345\326\330\174\330\121\200\065\235\165\242\152\057\002\045\074\033\331\140\120\270\135\256\374\000\053\157\255\250\101\023\331\356\153\061\220\204\276\102\315\340\160\365\041\002\201\201\000\307\376\326\171\321\116\131\176\132\253\342\032\060\027\111\256\241\071\007\343\011\257\011\273\250\207\110\151\215\251\116\245\277\347\042\204\301\354\045\347\067\355\207\006\312\050\361\351\221\211\303\165\215\341\121\057\250\134\061\263\136\246\160\005\047\005\100\333\327\253\306\266\222\125\143\047\245\023\332\356\222\367\327\025\172\121\072\317\174\132\326\235\177\251\313\163\265\266\152\053\243\135\123\316\240\136\047\033\355\367\361\274\025\230\004\374\060\130\264\320\022\232\217\054\227\373\034\177", 1192);

std::string pub_key = "AAAAB3NzaC1yc2EAAAADAQABAAABAQDcbvz5WAA0KUmdcBodf6M9w0lazreg58WI17U6sO7xwiyviEhyIZdRsUKLg+vYekTRr/ngQSvydtZM5Dx4zDA/ENigWrht6MW36iOCOebrTWPhN5sHA1DDq7qkRKprfM1KNNoMd6loXsLiU1NYcWekxVjVVKq1mXgSY/E3/i4dh7vvzcqQ2LTK0BAnIuiNDLgoaDNmwGBBHkwsNouXV+PTkGGwMuN+e9mGfbBVS0MxrTcGpyDEgcJyWHXFBW6hVNsAK4svmTmwpEhtDKPnZuhYBfZJTgZ8wHjJpouk1tQGaW/CXL5nT2sco51NpwZul1mE15i/LM564GLwwkP0Q5k/";
std::string priv_key = "MIIEpAIBAAKCAQEA3G78+VgANClJnXAaHX+jPcNJWs63oOfFiNe1OrDu8cIsr4hIciGXUbFCi4Pr2HpE0a/54EEr8nbWTOQ8eMwwPxDYoFq4bejFt+ojgjnm601j4TebBwNQw6u6pESqa3zNSjTaDHepaF7C4lNTWHFnpMVY1VSqtZl4EmPxN/4uHYe7783KkNi0ytAQJyLojQy4KGgzZsBgQR5MLDaLl1fj05BhsDLjfnvZhn2wVUtDMa03BqcgxIHCclh1xQVuoVTbACuLL5k5sKRIbQyj52boWAX2SU4GfMB4yaaLpNbUBmlvwly+Z09rHKOdTacGbpdZhNeYvyzOeuBi8MJD9EOZPwIDAQABAoIBAGjq5rtjOE2bbS9jQPrTWoY2If73rw0F4847JUY3GrO1AQHXMuwnstcuMIcpFiMmJwVK5frn6hvwlhVo+KNiRIBv6zt/kpK1nQ3pglckahWK80Qp7D7NRC6t2RsAl8CrWSa9ux7+AYLsv4Nrt5q792HEkICRWOMwlabjLNfCwn5IzvB46TK1K6fY0/ama0D809AUAH+FiFxk+MsDBCCqh9NbKidS5KsPS6wtKfYRkx102QDVWco+k9KKJ9bRAEQKJ3RsfAgNEMwAB5IASGW3TqHvVD/l5zg+92yZWibxAPv92Y94qZNC5c50TnCfEIy6vI5JqkMdtMSYXLBRa6tJVDECgYEA/ldsWOKnBFJjMZ+Zhj0WAwn3vNVaGRVnqrR3DNaPe9wgBXbaCZdKX55o49alb98FLNy1brwaq4NJ8OnVS7l1O9NXas4dGwoniecXSGsrSGC86xWBaCs7yXB82Gt6errSwHV9eY4YrzxkfNeWJnEeOURzXVAFQrsEiTZt0TaPmkkCgYEA3d72OQOzEbkNGosHmYzViVwwqE5dX9mGrQX32esuzwOicXWq/JHZauiXZ0SevcmbyG27FMYxrZaT2sAluq9jxC8NnutvW/B/yMo5pwnlVXxYYY3gsy3oH5DVJU6GdZnkhfm97o2GdsuF55Ix/RoYweVTP1euzDZ05mK4NlT5V0cCgYA9YUu8h7ZWzKszppieVM+jHBy1bae4tfm2sKaqan1mHtF7gBtOhTxlpw0ZLwvt25ycHweKGcs16RFHGqdnBvLL5U0LcYKErAauuR5dU7+2T+JHuYDpasWa75Kxh/6e78c8ux30394FLEXz+vM5g8MPfv14X39lg0ys8H3AJ7KwQQKBgQCqB6RKLTud6WLRZJp+Yh+DFNN1KBkGy30aO+ilaEaG/xIOQU64IE2uUHE3Aq9kYoywHOeyE/EeRrcofPhtCNw8DJMzptnAa56CEff8uui1ioVwvXnl1th82FGANZ11omovAiU8G9lgULhdrvwAK2+tqEET2e5rMZCEvkLN4HD1IQKBgQDH/tZ50U5Zflqr4howF0muoTkH4wmvCbuoh0hpjalOpb/nIoTB7CXnN+2HBsoo8emRicN1jeFRL6hcMbNepnAFJwVA29erxraSVWMnpRPa7pL31xV6UTrPfFrWnX+py3O1tmoro11TzqBeJxvt9/G8FZgE/DBYtNASmo8sl/scfw==";
    try
    {
        AutoSeededRandomPool rng;

RSA::PrivateKey privateKey;
RSA::PublicKey publicKey;

publicKey.Load(StringSource(pub_key,true,new CryptoPP::Base64Decoder()).Ref());
privateKey.Load(StringSource(priv_key,true,new CryptoPP::Base64Decoder()).Ref());

//         CryptoPP::Base64Decoder decoder;
//         decoder.Put( (byte*)priv_key.c_str(), priv_key.size() );
//         decoder.MessageEnd();
//         RSA::PrivateKey privateKey;
//         privateKey.Load(decoder);
//
//         CryptoPP::Base64Decoder _decoder;
//         _decoder.Put( (byte*)pub_key.c_str(), pub_key.size() );
//         _decoder.MessageEnd();
//         RSA::PublicKey publicKey;
//         publicKey.Load(_decoder);

//         InvertibleRSAFunction parameters;
//         parameters.GenerateRandomWithKeySize( rng, 1024 );
//         RSA::PrivateKey privateKey( parameters );
//         RSA::PublicKey publicKey( parameters );

        // Message
        string message = "Yoda said, Do or Do Not. There is not try.";
        string signature;

        ////////////////////////////////////////////////
        // Sign and Encode
        RSASS<PSS, SHA1>::Signer signer( privateKey );
        StringSource( message, true,
            new SignerFilter( rng, signer,
                new StringSink( signature )
            ) // SignerFilter
        ); // StringSource

        ////////////////////////////////////////////////
        // Verify and Recover
        RSASS<PSS, SHA1>::Verifier verifier( publicKey );

        StringSource( message+signature, true,
            new SignatureVerificationFilter(
                verifier, NULL,
                SignatureVerificationFilter::THROW_EXCEPTION
            ) // SignatureVerificationFilter
        ); // StringSource

        cout << "Verified signature on message" << endl;

    }
    catch( CryptoPP::Exception& e )
    {
        std::cerr << "Error: " << e.what() << std::endl;
    }

    return 0;
}